plugins {
    id 'java'
    id 'fabric-loom' version '1.7-SNAPSHOT'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

group = "com.techno.client"
version = "1.0.0"

repositories {
    mavenCentral()
    maven { url "https://repo.spongepowered.org/maven" }
}

dependencies {
    // Minecraft 1.8.9
    minecraft "com.mojang:minecraft:1.8.9"
    mappings "net.fabricmc:yarn:1.8.9+build.306:v2" // Using Yarn for 1.8.9, widely available

    // Mixin & LaunchWrapper
    implementation "org.spongepowered:mixin:0.7.11-SNAPSHOT"
    implementation "net.minecraft:launchwrapper:1.12"

    // Annotation processor for Mixin
    annotationProcessor "org.spongepowered:mixin:0.7.11-SNAPSHOT"
}

loom {
    // Disable Fabric Mod generated files since this is a Tweaker
    runConfigs.configureEach {
        ideConfigGenerated = true
    }
}

// Ensure the final jar is named correctly for the launcher
base {
    archivesName = "ProjectTechno"
}


// Shadow Task - Bundle dependencies (Mixin)
shadowJar {
    configurations = [project.configurations.implementation]
    archiveClassifier = 'dev-all' // Intermediate jar
    
    // Exclude Minecraft and other provided libs
    exclude 'license/**'
    exclude 'META-INF/maven/**'
    exclude 'META-INF/LICENSE*'
    exclude 'META-INF/NOTICE*'
}

// Remap the Shadow Jar (this is the final artifact)
remapJar {
    inputFile = shadowJar.archiveFile
    archiveClassifier = '' // Main artifact
    dependsOn shadowJar
}

// Manifest for the Tweaker
jar {
    manifest {
        attributes(
            "TweakClass": "com.techno.client.TechnoTweaker",
            "MixinConfigs": "techno.mixins.json",
            "ForceLoadAsMod": "true" 
        )
    }
}

// Task to zip up the deliverables for the user
task distribution(type: Zip) {
    dependsOn remapJar
    from(remapJar) {
        into "ProjectTechno"
        rename { "ProjectTechno.jar" }
    }
    from("src/main/resources/version.json") {
        into "ProjectTechno"
    }
    archiveFileName = "ProjectTechno_Install.zip"
}
