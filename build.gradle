plugins {
    id 'java'
    id 'fabric-loom' version '1.7-SNAPSHOT'
}

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

group = "com.techno.client"
version = "1.0.0"

repositories {
    mavenCentral()
    maven { url "https://maven.legacyfabric.net/" }
    maven { url "https://repo.spongepowered.org/maven" }
}

dependencies {
    // Minecraft 1.8.9
    minecraft "com.mojang:minecraft:1.8.9"
    mappings "net.legacyfabric:yarn:1.8.9+build.576:v2" // Legacy Fabric Mappings

    // Mixin & LaunchWrapper
    implementation("org.spongepowered:mixin:0.8.5") {
        exclude module: 'launchwrapper'
        exclude module: 'guava'
    }
    implementation "net.minecraft:launchwrapper:1.12"

    // Annotation processor for Mixin
    annotationProcessor "org.spongepowered:mixin:0.8.5:processor"
}

loom {
    // Disable Fabric Mod generated files since this is a Tweaker
    runConfigs.configureEach {
        ideConfigGenerated = true
    }
}

// Ensure the final jar is named correctly for the launcher
base {
    archivesName = "ProjectTechno"
}


// Remap the standard jar
remapJar {
    inputFile = jar.archiveFile
    archiveClassifier = '' // Main artifact
}

// Manifest for the Tweaker
jar {
    manifest {
        attributes(
            "TweakClass": "com.techno.client.TechnoTweaker",
            "MixinConfigs": "techno.mixins.json",
            "ForceLoadAsMod": "true" 
        )
    }
}

// Task to zip up the deliverables for the user
task distribution(type: Zip) {
    dependsOn remapJar
    from(remapJar) {
        into "ProjectTechno"
        rename { "ProjectTechno.jar" }
    }
    from("src/main/resources/version.json") {
        into "ProjectTechno"
    }
    archiveFileName = "ProjectTechno_Install.zip"
}
